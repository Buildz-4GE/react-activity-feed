// @flow

import React from 'react';
import placeholder from '../images/placeholder.png';
import { IconButton } from 'react-file-utils';
import { sanitizeURL } from '../utils';

export type Props = {|
  image?: ?string,
  images?: Array<{ image: string }>,
  alt?: ?string,
  title?: ?string,
  url?: string,
  nolink?: boolean,
  description?: ?string,
  id?: ?string,
  handleClose?: (e: SyntheticEvent<>) => mixed,
|};

/**
 * Component is described here.
 *
 * @example ./examples/Card.md
 */
export default class Card extends React.Component<Props> {
  trimUrl = (url: string) => {
    let trimmedUrl;
    if (url !== undefined || url !== null) {
      trimmedUrl = url
        .replace(/^(?:https?:\/\/)?(?:www\.)?/i, '')
        .split('/')[0];
    }
    return trimmedUrl;
  };

  _handleClose = (e: SyntheticEvent<>) => {
    if (this.props.handleClose) {
      this.props.handleClose(e);
    }
  };

  render() {
    const { alt, images, handleClose, nolink } = this.props;
    let image = this.props.image;
    if (!image && images && images.length) {
      image = images[0].image;
    }

    const url = sanitizeURL(this.props.url);
    const svg =
      '<svg width="28" height="28" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm1.41-1.41A8 8 0 1 0 15.66 4.34 8 8 0 0 0 4.34 15.66zm9.9-8.49L11.41 10l2.83 2.83-1.41 1.41L10 11.41l-2.83 2.83-1.41-1.41L8.59 10 5.76 7.17l1.41-1.41L10 8.59l2.83-2.83 1.41 1.41z"/></svg>';

    const cardFallbackImageId = this.props.id
      ? 'cardFallback-' + this.props.id
      : '';
    const cardImageId = this.props.id ? 'cardImage-' + this.props.id : '';

    return (
      <a
        href={!nolink ? url : null}
        className={`raf-card ${
          image !== undefined ? 'raf-card--with-image' : ''
        }`}
      >
        {handleClose && image ? (
          <IconButton onClick={(e) => this._handleClose(e)}>
            <div dangerouslySetInnerHTML={{ __html: svg }} />
          </IconButton>
        ) : null}
        {image !== undefined && (
          <div className="raf-card__image">
            <svg
              id={cardFallbackImageId}
              className="fill-current w-full text-gray-300"
              style={{ display: 'none' }}
              version="1.0"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 360 144"
              preserveAspectRatio="xMidYMid meet"
            >
              <g
                transform="translate(0.000000,144.000000) scale(0.100000,-0.100000)"
                fill=""
                stroke="none"
              >
                <path d="M1185 1360 c-223 -13 -312 -43 -388 -132 l-45 -53 -99 -3 c-120 -3 -139 -14 -170 -98 -25 -69 -26 -74 -13 -74 6 0 10 4 10 10 0 25 43 121 58 129 9 5 60 12 112 16 87 6 93 6 75 -9 -11 -8 -15 -16 -8 -16 6 0 39 31 73 70 116 129 173 142 650 144 413 1 575 -16 575 -61 0 -18 165 -194 175 -188 5 3 16 -5 24 -17 9 -12 18 -19 22 -16 3 4 -43 60 -103 126 -119 133 -137 144 -263 162 -99 14 -508 20 -685 10z m915 -155 c30 -30 52 -55 49 -55 -2 0 -29 25 -59 55 -30 30 -52 55 -49 55 2 0 29 -25 59 -55z" />
                <path d="M1685 1314 c-22 -2 -125 -9 -228 -15 -104 -7 -203 -15 -220 -19 l-32 -7 40 -8 c24 -5 131 -2 270 9 127 9 273 17 325 17 l95 1 -50 13 c-48 12 -112 15 -200 9z" />
                <path d="M940 1283 c-44 -17 -140 -131 -145 -173 -3 -24 3 -35 31 -58 31 -26 51 -31 199 -52 138 -20 161 -26 147 -37 -24 -18 2 -17 38 2 16 8 35 12 44 9 8 -3 86 2 173 10 182 19 236 27 210 33 -9 3 -15 8 -12 12 4 8 -9 7 -229 -13 l-128 -12 -9 24 c-5 13 -9 42 -10 65 -1 23 -5 67 -9 97 -7 42 -8 30 -4 -53 4 -118 12 -143 46 -150 23 -4 23 -4 1 -6 -38 -2 -51 23 -57 111 -11 152 -14 164 -11 43 2 -66 7 -129 11 -139 6 -17 4 -18 -22 -12 -39 9 -237 43 -297 51 -32 4 -58 15 -78 33 l-29 27 66 79 c36 43 61 75 54 71 -8 -5 -11 -4 -6 3 4 6 13 9 21 6 12 -5 12 -9 0 -27 -18 -30 -45 -125 -44 -156 1 -18 5 -11 15 24 8 28 23 73 34 101 13 38 15 55 7 63 -8 8 17 9 94 5 57 -4 111 -7 120 -7 14 -1 18 -18 24 -97 3 -52 10 -111 16 -130 7 -30 8 -27 4 20 -3 30 -5 90 -5 132 l0 77 -37 10 c-48 12 -203 22 -223 14z m-75 -95 c-67 -74 -69 -75 -59 -57 15 27 88 108 98 109 5 0 -13 -24 -39 -52z" />
                <path d="M615 1106 c45 -8 103 -25 133 -40 57 -29 82 -29 39 -1 -52 34 -127 55 -190 54 l-62 -1 80 -12z" />
                <path d="M2103 1063 c-24 -2 -43 -8 -43 -12 0 -14 63 -21 103 -12 41 10 60 21 36 21 -8 0 -23 2 -34 4 -11 1 -39 1 -62 -1z" />
                <path d="M1764 1050 c-140 -12 -137 -30 11 -60 169 -35 287 -69 362 -106 102 -51 106 -65 10 -33 -167 56 -457 137 -457 128 0 -5 2 -9 5 -9 3 0 123 -36 267 -80 145 -44 272 -80 282 -80 18 0 18 2 -5 26 -58 62 -234 125 -509 181 -43 9 -41 10 55 17 55 4 129 11 165 16 l65 7 -85 0 c-47 0 -121 -3 -166 -7z" />
                <path d="M1945 1029 c11 -5 81 -24 155 -43 75 -19 160 -46 190 -60 93 -43 246 -125 235 -126 -30 -1 -488 -70 -492 -74 -3 -2 -33 11 -66 29 -88 48 -227 100 -406 151 -86 25 -165 47 -176 50 -14 5 -17 3 -10 -5 6 -6 89 -33 184 -61 244 -71 388 -131 494 -206 26 -19 47 -30 47 -25 0 5 -14 20 -31 32 l-32 22 259 38 259 38 38 -31 c46 -36 61 -32 17 5 -30 26 -30 26 -8 31 13 3 73 10 133 17 61 7 119 16 130 20 31 12 3 11 -160 -7 l-150 -17 -65 33 c-36 18 -90 47 -120 65 -68 40 -180 79 -320 111 -111 25 -138 29 -105 13z" />
                <path d="M2290 1028 c19 -6 44 -14 55 -18 11 -4 97 -27 190 -50 94 -23 208 -56 255 -72 78 -28 244 -108 237 -115 -7 -6 -108 -22 -272 -43 -93 -12 -262 -34 -375 -50 -113 -15 -252 -33 -310 -40 -58 -7 -112 -17 -120 -22 -10 -6 -4 -8 19 -4 33 6 33 5 18 -12 -22 -25 -22 -39 1 -19 9 9 41 19 70 23 30 4 48 10 42 14 -17 10 59 21 79 11 9 -4 101 2 211 15 153 18 175 22 100 19 -146 -6 -60 9 240 40 44 4 44 4 -10 -9 -81 -20 -32 -18 104 4 66 10 124 16 129 13 11 -7 0 -103 -14 -120 -6 -7 -35 -19 -64 -28 -29 -8 -56 -21 -58 -28 -4 -9 -6 -8 -6 2 -1 12 -4 12 -18 -1 -23 -20 -129 -44 -273 -62 -163 -21 -220 -24 -226 -15 -3 5 16 9 43 10 26 1 73 5 103 9 33 5 -3 6 -91 2 -144 -5 -147 -5 -159 18 -6 12 -10 44 -8 71 3 44 1 47 -11 32 -12 -17 -13 -16 -8 6 4 18 3 21 -6 12 -11 -11 -12 -72 -1 -124 7 -35 34 -50 68 -37 15 5 26 6 26 1 0 -12 -36 -19 -147 -27 -51 -3 -93 -10 -93 -16 0 -5 18 -7 43 -4 23 3 146 15 272 27 264 24 303 30 558 89 119 28 195 51 207 62 16 15 20 31 19 76 l-1 57 -9 -59 c-5 -33 -14 -63 -21 -68 -13 -8 -57 -21 -113 -34 -28 -6 -29 -5 -10 9 11 8 36 17 56 21 21 4 42 13 49 21 13 16 0 21 -15 6 -6 -4 -25 -11 -42 -14 -25 -5 -33 -3 -33 8 0 10 11 15 34 15 18 0 39 7 46 15 11 13 8 15 -18 15 -17 0 -34 -5 -37 -10 -12 -19 -22 -1 -20 37 2 35 5 38 36 44 19 3 42 1 52 -3 10 -6 17 -5 17 2 0 18 -28 23 -70 12 -22 -5 -42 -6 -45 -2 -6 10 56 20 126 20 36 0 59 -5 62 -12 2 -7 3 -40 1 -73 -2 -42 0 -53 6 -35 16 48 11 102 -12 136 -32 46 -115 98 -206 128 -87 29 -610 137 -656 135 l-31 -1 35 -10z m394 -78 c164 -34 259 -61 331 -95 58 -27 115 -66 115 -79 0 -1 -19 -3 -42 -4 -28 -1 -48 4 -62 16 -56 50 -191 108 -356 152 -124 34 -119 38 14 10z" />
                <path d="M2150 1021 c8 -5 42 -14 75 -21 96 -19 213 -59 313 -105 50 -24 92 -40 92 -36 0 13 -155 85 -245 114 -115 38 -274 70 -235 48z" />
                <path d="M824 995 c-10 -15 -20 -51 -22 -81 -4 -52 -5 -54 -31 -49 l-26 5 28 -11 c15 -6 27 -18 27 -28 0 -30 38 -130 60 -159 12 -15 42 -39 68 -54 26 -15 43 -28 37 -28 -17 0 -109 56 -129 79 -11 11 -16 21 -12 21 7 0 -71 148 -87 165 -6 6 -7 1 -3 -15 6 -25 6 -25 -5 -2 -11 20 -29 31 -29 17 0 -14 33 -54 40 -50 5 3 12 0 16 -6 4 -8 3 -9 -4 -5 -25 15 -10 -13 29 -58 22 -25 36 -46 30 -46 -13 0 -66 68 -124 160 -39 60 -48 67 -110 93 -38 16 -72 26 -75 23 -3 -4 8 -11 24 -17 l29 -12 3 -106 c7 -225 71 -363 129 -275 19 29 32 189 17 204 -5 5 -8 -19 -7 -58 l1 -67 -15 95 c-13 76 -18 91 -25 74 -7 -14 -6 -41 3 -80 8 -33 12 -68 11 -79 -5 -45 -13 -65 -28 -65 -8 0 -13 -4 -9 -10 10 -17 35 1 44 34 5 17 10 23 10 14 1 -9 -4 -29 -9 -43 -7 -20 -16 -26 -33 -23 -12 2 -22 10 -23 18 -1 8 -9 33 -19 55 -14 30 -19 65 -19 138 -1 87 1 100 19 114 16 13 17 15 3 10 -22 -8 -24 11 -3 20 23 8 46 -17 104 -112 36 -59 71 -101 114 -136 34 -29 63 -55 65 -59 7 -18 -52 -49 -106 -55 -75 -8 -106 -15 -99 -22 4 -3 41 -2 84 2 69 6 80 10 110 40 l33 33 117 -52 c65 -29 159 -70 209 -92 l92 -39 6 -54 c7 -59 44 -146 83 -192 37 -43 91 -68 179 -80 92 -13 152 -1 217 42 42 28 88 92 75 105 -4 3 -13 -7 -21 -23 -31 -59 -108 -105 -197 -117 l-45 -7 31 15 c40 18 82 71 106 130 25 63 14 58 -21 -11 -47 -93 -69 -108 -156 -108 -65 0 -78 3 -117 30 -128 91 -158 351 -51 452 21 21 29 33 19 33 -8 0 -28 -17 -45 -37 -30 -36 -31 -37 -31 -13 0 34 26 70 50 70 11 0 44 -11 73 -24 60 -26 89 -58 182 -200 66 -99 118 -140 223 -173 45 -15 59 -15 95 -4 23 7 94 17 157 23 63 5 120 14 125 19 14 14 -153 1 -228 -17 -86 -21 -125 -17 -194 15 -93 44 -117 66 -168 152 -48 82 -123 172 -159 191 -11 6 -91 35 -176 64 l-155 53 3 68 c5 111 -11 107 185 53 289 -81 372 -117 500 -216 31 -25 57 -41 57 -36 0 14 -89 84 -162 128 -32 19 -94 48 -137 64 -72 27 -407 120 -429 120 -17 0 -32 -52 -32 -114 l0 -64 -157 49 c-87 27 -169 49 -182 49 -23 0 -23 2 -17 52 4 28 14 64 22 80 20 39 11 48 -12 13z m-235 -92 c-7 -10 -15 -20 -16 -22 -2 -2 -3 5 -3 17 0 14 6 22 16 22 14 0 15 -3 3 -17z m408 -115 l171 -52 12 -60 c15 -78 47 -161 67 -178 9 -7 14 -8 12 -3 -31 66 -41 93 -54 142 -26 98 -29 96 83 60 53 -17 99 -33 101 -34 3 -2 -5 -11 -18 -19 -17 -13 -22 -25 -21 -62 1 -63 -11 -153 -20 -150 -121 50 -329 142 -327 145 2 1 43 -13 92 -32 49 -19 90 -33 92 -31 2 2 -38 20 -89 40 -154 61 -210 95 -236 144 -25 46 -55 142 -44 142 4 0 84 -23 179 -52z" />
                <path d="M440 975 c-15 -18 -6 -45 14 -45 9 0 22 -12 30 -27 15 -31 66 -82 66 -67 -1 5 -14 25 -30 44 -18 20 -30 46 -30 62 0 15 -5 30 -11 34 -8 4 -9 -1 -4 -16 5 -17 4 -21 -6 -18 -8 3 -13 15 -12 27 3 25 0 26 -17 6z" />
                <path d="M625 837 c-8 -20 -15 -47 -15 -59 0 -36 27 -139 38 -150 6 -6 5 10 -4 37 -17 57 -18 148 -3 177 6 11 8 22 5 25 -3 4 -13 -10 -21 -30z" />
                <path d="M594 738 c11 -73 28 -127 44 -140 13 -11 13 -9 -1 18 -9 17 -21 61 -27 97 -13 73 -26 93 -16 25z" />
                <path d="M3018 713 c-17 -3 -28 -11 -28 -20 0 -12 7 -14 34 -10 22 4 36 1 39 -6 2 -7 8 -8 13 -3 5 5 4 11 -3 13 -7 3 -13 11 -13 19 0 8 -3 13 -7 13 -5 -1 -20 -4 -35 -6z" />
                <path d="M2770 680 c-19 -5 -156 -23 -305 -42 -148 -18 -260 -34 -247 -36 33 -5 451 46 551 68 47 10 75 18 61 18 -14 0 -41 -4 -60 -8z" />
                <path d="M2795 660 c-49 -10 -184 -30 -300 -44 -261 -32 -347 -47 -230 -40 189 13 624 79 643 99 8 8 -14 5 -113 -15z" />
                <path d="M2840 639 c-61 -15 -359 -57 -502 -70 -76 -7 -138 -17 -138 -22 0 -5 12 -6 28 -3 15 2 63 8 107 11 184 15 557 73 573 90 8 7 -28 4 -68 -6z" />
                <path d="M2725 590 c-71 -15 -218 -35 -325 -45 -214 -19 -269 -31 -94 -21 176 10 350 34 474 65 146 37 115 37 -55 1z" />
                <path d="M1431 562 c-107 -112 -68 -335 71 -408 81 -43 190 14 218 114 12 46 12 52 0 52 -5 0 -10 -7 -10 -16 0 -9 -9 -32 -21 -50 -11 -19 -17 -34 -13 -34 21 0 -45 -52 -78 -61 -31 -8 -46 -6 -81 9 -89 40 -143 138 -135 245 6 71 27 119 71 159 16 16 26 28 22 28 -5 0 -24 -17 -44 -38z" />
                <path d="M2761 569 c-77 -19 -185 -35 -330 -49 -118 -11 -217 -23 -220 -25 -8 -8 49 -5 254 15 187 18 394 58 420 81 12 12 8 11 -124 -22z" />
                <path d="M1492 573 c-44 -21 -80 -85 -87 -153 -4 -44 -1 -66 18 -110 13 -30 28 -54 34 -53 5 1 23 -12 39 -30 l29 -32 -32 29 c-18 17 -33 25 -33 18 0 -21 71 -66 104 -66 34 1 113 31 103 40 -3 3 -15 0 -28 -6 -36 -20 -97 -6 -136 32 -61 59 -82 198 -39 263 10 15 33 33 53 41 19 9 33 18 30 21 -3 3 -20 -2 -38 -11 -18 -9 -34 -14 -37 -12 -2 3 10 12 27 21 17 8 31 18 31 20 0 7 -1 7 -38 -12z m-59 -223 c4 -30 3 -38 -3 -25 -8 19 -14 83 -6 74 2 -2 6 -24 9 -49z" />
                <path d="M1926 568 c-14 -54 3 -123 41 -169 l27 -32 136 7 c74 4 222 16 329 27 107 10 196 17 198 15 5 -5 -60 -14 -159 -22 -43 -4 -78 -10 -78 -13 0 -9 161 5 235 20 32 7 53 15 45 17 -8 3 6 11 30 18 55 17 63 17 54 3 -5 -9 1 -10 20 -5 22 5 26 3 26 -14 0 -33 -19 -60 -40 -60 -21 0 -24 8 -20 49 1 14 -2 21 -9 17 -6 -4 -11 -20 -11 -35 0 -52 44 -68 83 -28 16 15 38 23 67 25 53 3 80 19 111 64 l22 33 -39 -37 c-30 -29 -51 -39 -88 -44 -48 -7 -49 -7 -43 17 6 23 6 24 -10 4 -15 -19 -15 -19 -11 6 4 23 2 25 -21 21 -62 -11 -6 8 106 37 67 17 135 36 150 42 18 6 24 7 18 0 -10 -10 -177 -61 -201 -61 -8 0 -14 -5 -14 -10 0 -11 15 -9 134 26 91 26 130 51 134 85 2 21 1 22 -10 8 -23 -28 -50 -37 -274 -93 -212 -52 -229 -55 -528 -80 -344 -29 -347 -29 -379 34 -12 25 -17 52 -15 93 3 58 -5 75 -16 35z" />
                <path d="M2050 583 c-48 -5 -81 -26 -79 -52 0 -10 3 -11 5 -4 3 7 32 15 65 19 33 4 57 9 54 12 -2 3 0 11 6 19 6 7 8 12 3 11 -5 -1 -29 -3 -54 -5z" />
                <path d="M2030 521 c-25 -3 -45 -11 -45 -18 0 -6 -3 -15 -7 -19 -13 -12 13 -34 41 -34 41 0 101 12 101 20 0 3 -26 3 -57 -1 -31 -4 -61 -5 -66 -2 -15 9 16 23 53 23 38 0 54 8 58 28 2 13 -4 13 -78 3z" />
                <path d="M1535 435 c-31 -30 -32 -66 -2 -101 18 -20 28 -25 46 -19 28 9 49 51 34 66 -13 13 -36 2 -27 -12 3 -5 10 -6 16 -3 6 4 6 -2 -1 -15 -14 -25 -33 -28 -25 -3 5 16 5 16 -9 -1 -12 -14 -16 -15 -25 -4 -8 10 -8 17 -1 24 8 8 8 13 0 17 -6 4 -11 12 -11 17 0 6 5 7 10 4 9 -6 14 8 11 28 0 4 8 7 19 7 12 0 17 -5 14 -14 -7 -17 12 -31 21 -16 7 12 -22 50 -37 50 -5 0 -20 -11 -33 -25z" />
                <path d="M1897 433 c-13 -12 -7 -40 13 -58 11 -10 20 -21 20 -24 0 -3 -30 -5 -67 -4 -56 2 -63 1 -43 -8 27 -11 172 -6 320 11 47 5 94 10 104 10 11 0 17 3 14 6 -4 3 -68 0 -143 -6 -76 -6 -147 -9 -159 -6 -12 3 -29 18 -38 34 -16 26 -16 29 0 39 15 10 15 12 1 12 -9 1 -19 -2 -22 -6z" />
                <path d="M1735 382 c30 -14 162 -25 150 -13 -5 5 -46 12 -90 15 -48 4 -72 3 -60 -2z" />
                <path d="M2305 355 c-30 -29 -32 -56 -7 -78 24 -22 44 -21 73 2 18 14 48 20 119 24 91 5 240 41 240 58 0 4 -39 -3 -87 -16 -49 -13 -123 -26 -165 -29 l-78 -7 0 28 c0 22 -2 25 -10 13 -9 -13 -10 -13 -11 0 -1 8 -1 18 0 23 3 17 -52 5 -74 -18z m60 -4 c3 -10 1 -31 -5 -45 -7 -20 -16 -27 -32 -24 -29 4 -34 32 -14 63 19 30 42 32 51 6z" />
                <path d="M2916 338 c-5 -16 -9 -28 -11 -28 -1 0 -73 -20 -159 -45 -156 -44 -197 -50 -491 -75 -130 -11 -226 -11 -219 1 4 7 -21 31 -46 44 -8 5 -4 -4 10 -19 14 -15 23 -31 21 -34 -2 -4 7 -12 20 -19 25 -12 35 -11 379 23 123 12 188 24 317 61 90 25 170 51 179 57 10 8 14 22 12 37 l-4 24 -8 -27z" />
                <path d="M1969 210 c13 -11 28 -20 35 -20 6 0 0 9 -14 20 -33 26 -52 25 -21 0z" />
              </g>
            </svg>
            <img
              id={cardImageId}
              onError={() => {
                document.getElementById(cardImageId).style.display = 'none';
                document.getElementById(cardFallbackImageId).style.display =
                  'block';
              }}
              src={image == null ? placeholder : image}
              alt={alt || this.props.title || this.props.description || ''}
              loading="lazy"
            />
          </div>
        )}
        <div className="raf-card__content">
          <div className="raf-card__content-left">
            <p className="raf-card__title">{this.props.title}</p>
            <p className="raf-card__url">{this.trimUrl(url || '')}</p>
            <p className="raf-card__description">{this.props.description}</p>
          </div>
          {handleClose && image === undefined ? (
            <div className="raf-card__content-right">
              <IconButton onClick={(e) => this._handleClose(e)}>
                <div dangerouslySetInnerHTML={{ __html: svg }} />
              </IconButton>
            </div>
          ) : null}
        </div>
      </a>
    );
  }
}
